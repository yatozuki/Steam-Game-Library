<%- include('partials/game/detailHeader.ejs') %>
<%- include('partials/navbar.ejs') %>

<!-- Game Title -->
<h1><%= game.name %></h1>

<div class="container">
    <!-- Left Side: Image, Video, Description -->
    <div class="left-container">

        <div class="content-container visual">
            <div class="carousel-wrapper">
                <button class="carousel-nav prev" aria-label="Previous">&lt;</button>

                <div class="main-carousel">

                    <% if (game.movies) { %>
                        <% for (let i = 0; i < game.movies.length; i++) { %>
                            <div class="carousel-item" data-index="<%= (game.screenshots ? game.screenshots.length : 0) + i %>">
                                <video class="game-video" preload="metadata" controls poster="<%= game.movies[i].thumbnail %>" loading="lazy" playsinline>
                                    <source src="<%= game.movies[i].mp4['480'] %>" type="video/mp4" title="480">
                                    <source src="<%= game.movies[i].mp4.max %>" type="video/mp4" title="Full HD">
                                    <source src="<%= game.movies[i].webm['480'] %>" type="video/webm" title="480">
                                    <source src="<%= game.movies[i].webm.max %>" type="video/webm" title="Full HD">
                                    
                                    Your browser does not support the video tag.
                                </video>
                            </div>
                        <% } %>
                    <% } %>

                    <% if (game.screenshots) { %>
                        <% for (let i = 0; i < game.screenshots.length; i++) { %>
                            <div class="carousel-item" data-index="<%= i %>">
                                <img src="<%= game.screenshots[i].path_thumbnail || game.screenshots[i].path_full %>" alt="<%= game.name %> screenshot <%= i+1 %>" loading="lazy">
                            </div>
                        <% } %>
                    <% } %>
                    
                </div>

                <button class="carousel-nav next" aria-label="Next">&gt;</button>

            </div>
            
            <!-- Thumbnail strip -->
            <% if (game.screenshots.length > 0 || game.movies.length > 0) { %>
                <div class="thumbnail-strip-wrapper">
                    <div class="thumbnail-strip">
                        <% if (game.movies) { %>
                            <% for (let i = 0; i < game.movies.length; i++) { %>
                                <div class="thumbnail-item" data-index="<%= (game.screenshots ? game.screenshots.length : 0) + i %>">
                                    <img src="<%= game.movies[i].thumbnail %>" alt="Video thumbnail <%= i+1 %>" loading="lazy">
                                    <div class="video-indicator">▶</div>
                                </div>
                            <% } %>
                        <% } %>
                        <% if (game.screenshots) { %>
                            <% for (let i = 0; i < game.screenshots.length; i++) { %>
                                <div class="thumbnail-item" data-index="<%= i %>">
                                    <img src="<%= game.screenshots[i].path_thumbnail || game.screenshots[i].path_full %>" alt="Thumbnail <%= i+1 %>" loading="lazy">
                                </div>
                            <% } %>
                        <% } %>
                        
                        
                    </div>
                </div>

            <% } %>
        </div>

        <!-- Game Description -->
        <div class="content-container about">
            <h3>About this game</h3>
            <hr>
            <span>
                <%- game.about_the_game %>
            </span>
        </div>
    </div>

    <!-- Right Side: Ratings, Info, Requirements -->
    <div class="right-container">
        <!-- Ratings -->
        <div class="box-container box-rating">

            <div class="rating-container">
                <div class="rating-img">❤️</div>

                <div class="rating-text">
                    <!-- Recent Reviews -->
                    <p class="rating-text__item">
                        <strong>Recent Reviews:</strong>
                        <span class="rating-status">
                            <span class="rating-color">Positive</span>
                            <span class="rating-count">(8,644)</span>
                        </span>
                    </p>
                    <!-- All Reviews -->
                    <p class="rating-text__item">
                        <strong>All Reviews:</strong>
                        <span class="rating-status">
                            <span class="rating-color">Positive</span>
                            <span class="rating-count">(751,864)</span>
                        </span>
                    </p>
                </div>
            </div>
        </div>
        <!-- Game Informations -->
        <div class="box-container box-info">

            <img class="header-img"
                src="<%= game.header_image %>"
                alt="">
            <!-- Short Description -->
            <div class="info-container">
                <div class="info-short-description">
                    <%= game.short_description  %>
                </div>

                <!-- Info List -->
                <div class="info">
                    <!-- Release Date -->
                    <p class="info__item">
                        <strong>Release Date:</strong>
                        <% if (game.release_date.coming_soon === false) { %>
                            <span><%= game.release_date.date %></span>
                        <% } else { %>
                            <span><%= game.release_date.date %></span>
                        <% } %>
                    </p>
                    <!-- Platforms -->
                    <p class="info__item">
                        <strong>Platform:</strong>
                        <span class="platforms">
                        <% if (game.platforms?.windows) { %>
                            <span class="platform w">Windows</span>
                        <% } %>

                        <% if (game.platforms?.mac) { %>
                            <span class="platform m">MacOS</span>
                        <% } %>

                        <% if (game.platforms?.linux) { %>
                            <span class="platform l">Linux</span>
                        <% } %>
                        </span>
                    </p>
                    <!-- Developer -->
                    <% if (game.publishers) { %>
                    <p class="info__item">
                        <strong>Developer:</strong>
                        <% for (let i = 0; i < game.developers.length; i++) { %>
                        <span><%= game.developers[i]  %></span>
                        <% } %>
                    </p>
                    <% } %>
                    <!-- Publisher -->
                    <% if (game.publishers) { %>
                        <p class="info__item">
                            <strong>Publisher:</strong>
                            <% for (let i = 0; i < game.publishers.length; i++) { %>
                            <span><%= game.publishers[i]  %></span>
                            <% } %>
                        </p>
                    <% } %>

                    <!-- AppID -->
                    <p class="info__item">
                        <strong>App ID:</strong>
                        <span><%= game.steam_appid %></span>
                    </p>
                    <!-- Genres -->
                     <% if (game.genres) { %>
                        <p class="info__item">    
                            <strong>Genres:</strong>
                            <span class="genre-tags">
                            <% for (let i = 0; i < game.genres.length; i++) { %>
                                <span class="genre-tag"><%= game.genres[i].description  %></span>
                            <% } %>
                            </span>
                        </p>
                    <% } %>
                </div>
                <!-- Price -->
                <a href="https://store.steampowered.com/app/<%= game.steam_appid %>" target="_blank">
                    <div class="price-container">
                        <div class="price-items">
                            <img width="50"
                                src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Steam_icon_logo.svg/1280px-Steam_icon_logo.svg.png"
                                alt="Steam">

                            <div class="price-info">
                                <!-- Free -->
                                <% if (game.is_free) { %>
                                    <p class="game-price">
                                        <span class="current-price free">
                                            <strong class="free-tag">Free</strong>
                                        </span>
                                    </p>

                                <!-- "Coming soon" OR "To be announced" game -->
                                <% } else if (game.release_date.coming_soon === true) { %>
                                    <p class="game-price">
                                        <span class="current-price">
                                            <strong><%= game.release_date.date %></strong>
                                        </span>
                                    </p>

                                <!-- If price data exist -->
                                <% } else if (game.price_overview) { %>
                                    <!-- If there is discount -->
                                    <% if (game.price_overview.discount_percent > 0) { %>

                                        <!-- Only choose 1 class depending on result data. Red (0 - 40), Yellow (41 - 65), Green (66 - 100). If there is no data, then leave the class empty '' -->
                                        <% let colorClass = game.price_overview.discount_percent <= 40 ? 'game-price__discount-red': 
                                                            game.price_overview.discount_percent <= 65 ? 'game-price__discount-yellow':
                                                            game.price_overview.discount_percent <= 100 ? 'game-price__discount-green': '';
                                        %>

                                        <p class="game-price">
                                            <!-- Discount Percentage -->
                                            <span class="discount <%= colorClass %>">
                                                -<%= game.price_overview.discount_percent %>%
                                            </span>
                                            <span class="oc-price">
                                                <!-- Original Price -->
                                                <span class="original-price">
                                                    <%= game.price_overview.initial_formatted %>
                                                </span>
                                                <!-- Final Discount Price -->
                                                <span class="current-price">
                                                    <%= game.price_overview.final_formatted %>
                                                </span>
                                            </span>
                                            
                                        </p>
                                    <!-- Otherwise, just show original price (A.k.a. Final price) -->
                                    <% } else { %>
                                        <p class="game-price">
                                            <span class="current-price single">
                                                <%= game.price_overview.final_formatted %>
                                            </span>
                                        </p>
                                    <% } %>
                                    
                                <!-- If none of those price data exist, then show 'N/A' -->
                                <% } else { %>
                                    <p class="game-price">
                                        <span class="current-price">
                                            <em>N/A</em>
                                        </span>
                                    </p>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </a>

            </div>
        </div>
        <!-- System Requirements -->
        <div class="box-container box-requirement">
            <h3>System Requirements</h3>
            <!-- Platform Icons -->
            <div class="platform-icons-container">
                <hr>
                <div class="p-icons">
                    <% if (game.platforms?.windows) { %>
                        <button class="icon-btn windows">
                        <img class="platform-icon" src="https://images.seeklogo.com/logo-png/40/2/windows-11-icon-logo-png_seeklogo-406208.png" alt="Windows">
                        </button>
                    <% } %>

                    <% if (game.platforms?.mac) { %>
                        <button class="icon-btn mac">
                            <img class="platform-icon" src="https://cdn4.iconfinder.com/data/icons/flat-design-development-set-3/24/platform-mac-os-512.png" alt="MacOS">
                        </button>
                    <% } %>

                    <% if (game.platforms?.linux) { %>
                        <button class="icon-btn linux">
                            <img class="platform-icon" src="https://cdn-icons-png.flaticon.com/512/6124/6124995.png" alt="Linux">
                        </button>
                    <% } %>
                    
                </div>

                <hr>
            </div>
            <!-- Min & Max System Requirements -->
            <% if (min.length > 0 || max.length > 0) { %>
                <div class="system-requirements">
                    <% if (min.length > 0) { %>
                        <div class="min-requirement">
                            <strong class="minimum">MINIMUM</strong><br>
                            <ul class="req-ul">
                                <li><%- min %></li>
                            </ul>
                        </div>
                    <% } %>
                    <% if (max.length > 0) { %>
                        <hr class="req-line">
                        <div class="max-requirement">
                            <strong class="maximum">RECOMMENDED</strong><br>
                            <ul class="req-ul">
                                <li><%- max %></li>
                            </ul>
                        </div>
                    <% } %>
                </div>
            <% } else { %>
                <div class="system-requirements">
                    <div>
                        <ul class="default-ul"><li><%- game.pc_requirements.minimum %></li></ul>
                    </div>
                </div>
            <% } %>
        </div>
    </div>
</div>
<%- include('partials/footer.ejs') %>